# PowerShell에서 수동으로 실행할 배포 명령어들

# 1. 기존 파일 백업 (선택사항)
Copy-Item requirements.txt requirements_backup_$(Get-Date -Format 'yyyyMMdd_HHmmss').txt -ErrorAction SilentlyContinue
Copy-Item Dockerfile Dockerfile_backup_$(Get-Date -Format 'yyyyMMdd_HHmmss') -ErrorAction SilentlyContinue

# 2. 새로운 파일로 교체
Copy-Item requirements_step3.txt requirements.txt
Copy-Item Dockerfile.production Dockerfile

# 3. Docker 빌드
docker build --no-cache -t batch-keywords:latest .

# 4. 기존 컨테이너 정리
docker stop batch-keywords
docker rm batch-keywords

# 5. 새로운 컨테이너 실행
docker run -d --name batch-keywords --restart unless-stopped -v "${PWD}/.env:/app/.env:ro" -v "${PWD}/logs:/app/logs" -v "${PWD}/reports:/app/reports" batch-keywords:latest

# 6. 시스템 검증
Start-Sleep -Seconds 5
docker exec batch-keywords /app/validate.sh

# 7. 상태 확인
docker logs batch-keywords 